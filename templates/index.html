{% extends "base.html" %}

{% block title %}Home - Tasks{% endblock %}

{% block content %}
    <h1>My Tasks</h1>
    
    <div class="form-group">
        <input type="text" id="title" placeholder="Task Title">
        <input type="text" id="deadline" placeholder="Deadline (YYYY-MM-DD)">
        <button onclick="createTask()">Add Work Task</button>
    </div>

    <ul class="task-list">
        {% for task in tasks %}
            <li class="task-item">
                <span>{{ task.title }}</span>
                <span class="badge {{ task.type | lower }}">{{ task.type }}</span>
            </li>
        {% endfor %}
    </ul>
{% endblock %}

{% block scripts %}
<script>
    async function createTask() {
        // Използваме fetch API – модерен начин за пращане на заявки без презареждане на страницата.
        const title = document.getElementById('title').value;
        const deadline = document.getElementById('deadline').value;

        // body: JSON.stringify(...) превръща обекта ни в текст, за да мине през HTTP.
        const response = await fetch('/tasks', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                title: title,
                deadline: deadline,
                task_type: "Work"
            })
        });

        if (response.ok) {
            window.location.reload(); 
        } else {
            // Връщаме грешка, ако например Pydantic валидацията се провали.
            const errorData = await response.json();
            alert("Error: " + JSON.stringify(errorData.detail));
        }
    }
</script>
{% endblock %}