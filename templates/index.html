{% extends "base.html" %}

{% block title %}–ù–∞—á–∞–ª–æ - –ú–æ–∏—Ç–µ –ó–∞–¥–∞—á–∏{% endblock %}

{% block content %}
<div class="task-card animate-in">
    <h2>üöÄ –ù–æ–≤–∞ –∑–∞–¥–∞—á–∞</h2>
    <div class="input-group">
        <div class="input-field">
            <label for="title">–ö–∞–∫–≤–æ –ø–ª–∞–Ω–∏—Ä–∞—à?</label>
            <input type="text" id="title" placeholder="–Ω–∞–ø—Ä. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è">
        </div>
        <div class="input-field">
            <label for="deadline">–ö—Ä–∞–µ–Ω —Å—Ä–æ–∫</label>
            <input type="date" id="deadline">
        </div>
    </div>
    <button class="btn-primary main-action" onclick="createTask()">–î–æ–±–∞–≤–∏ –≤ —Å–ø–∏—Å—ä–∫–∞</button>
</div>

<div id="tasks-container">
    <ul class="task-list">
        {% for task in tasks %}
            <li class="task-item">
                <span>{{ task.title }}</span>
                <a href="/edit/{{ task.id }}" class="edit-link">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</a>
            </li>
        {% endfor %}
    </ul>
</div>
{% endblock %}

{% block scripts %}
<script>
    // –ó–∞—â–∏—Ç–∞: –ê–∫–æ –Ω—è–º–∞ —Ç–æ–∫–µ–Ω, –ø—Ä–µ–Ω–∞—Å–æ—á–∏ –∫—ä–º Login –≤–µ–¥–Ω–∞–≥–∞
    if (!localStorage.getItem('token')) {
        window.location.href = "/login";
    }

    async function createTask() {
        // –ò–∑–ø–æ–ª–∑–≤–∞–º–µ fetch API ‚Äì –º–æ–¥–µ—Ä–µ–Ω –Ω–∞—á–∏–Ω –∑–∞ –ø—Ä–∞—â–∞–Ω–µ –Ω–∞ –∑–∞—è–≤–∫–∏ –±–µ–∑ –ø—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞.
        const title = document.getElementById('title').value; // –í–∑–µ–º–∞–º–µ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏—Ç–µ –æ—Ç –∏–Ω–ø—É—Ç–∏—Ç–µ
        const deadline = document.getElementById('deadline').value; // –í–∑–µ–º–∞–º–µ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏—Ç–µ –æ—Ç –∏–Ω–ø—É—Ç–∏—Ç–µ

        // body: JSON.stringify(...) –ø—Ä–µ–≤—Ä—ä—â–∞ –æ–±–µ–∫—Ç–∞ –Ω–∏ –≤ —Ç–µ–∫—Å—Ç, –∑–∞ –¥–∞ –º–∏–Ω–µ –ø—Ä–µ–∑ HTTP.
        const response = await fetch('/tasks', {    // –ü—Ä–∞—â–∞–º–µ –∑–∞—è–≤–∫–∞ –∫—ä–º –Ω–∞—à–∏—è /tasks endpoint
            method: 'POST', // –ú–µ—Ç–æ–¥—ä—Ç –µ POST, –∑–∞—â–æ—Ç–æ —Å—ä–∑–¥–∞–≤–∞–º–µ –Ω–æ–≤ —Ä–µ—Å—É—Ä—Å
            headers: { 'Content-Type': 'application/json' }, // –ö–∞–∑–≤–∞–º–µ, —á–µ –ø—Ä–∞—â–∞–º–µ JSON
            body: JSON.stringify({  // –¢—è–ª–æ—Ç–æ –Ω–∞ –∑–∞—è–≤–∫–∞—Ç–∞ –µ JSON –æ–±–µ–∫—Ç —Å –¥–∞–Ω–Ω–∏—Ç–µ –∑–∞ –Ω–æ–≤–∞—Ç–∞ –∑–∞–¥–∞—á–∞
                title: title,
                deadline: deadline,
                task_type: "Work"
            })
        });

        if (response.ok) { // –ê–∫–æ –≤—Å–∏—á–∫–æ –µ –º–∏–Ω–∞–ª–æ –¥–æ–±—Ä–µ
            window.location.reload();   // –ü—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–º–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞, –∑–∞ –¥–∞ –≤–∏–¥–∏–º –Ω–æ–≤–∞—Ç–∞ –∑–∞–¥–∞—á–∞
        } else {
            // –í—Ä—ä—â–∞–º–µ –≥—Ä–µ—à–∫–∞, –∞–∫–æ –Ω–∞–ø—Ä–∏–º–µ—Ä Pydantic –≤–∞–ª–∏–¥–∞—Ü–∏—è—Ç–∞ —Å–µ –ø—Ä–æ–≤–∞–ª–∏.
            const errorData = await response.json();    // –í–∑–µ–º–∞–º–µ –≥—Ä–µ—à–∫–∞—Ç–∞ –∫–∞—Ç–æ JSON
            alert("Error: " + JSON.stringify(errorData.detail));    // –ü–æ–∫–∞–∑–≤–∞–º–µ —è –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
        }
    }
</script>
{% endblock %}