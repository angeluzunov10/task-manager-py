{% extends "base.html" %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ{% endblock %}

{% block content %}
<div class="auth-container" style="margin-top: 2rem;"> <div class="auth-box" style="max-width: 500px;"> <h2 style="color: var(--primary); margin-bottom: 1.5rem; text-align: center;">üéØ –†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ</h2>
        
        <div class="field-group">
            <label style="font-weight: 600; font-size: 0.9rem;">–ó–∞–≥–ª–∞–≤–∏–µ –Ω–∞ –∑–∞–¥–∞—á–∞—Ç–∞</label>
            <input type="text" id="edit-title" placeholder="–ò–º–µ –Ω–∞ –∑–∞–¥–∞—á–∞—Ç–∞">
        </div>
        
        <div class="field-group">
            <label style="font-weight: 600; font-size: 0.9rem;">–û–ø–∏—Å–∞–Ω–∏–µ / –ë–µ–ª–µ–∂–∫–∏</label>
            <textarea id="edit-desc" rows="5" placeholder="–î–æ–±–∞–≤–∏ –¥–µ—Ç–∞–π–ª–∏ —Ç—É–∫..." 
                      style="width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 1.2rem; font-family: inherit;"></textarea>
        </div>

        <div class="action-buttons" style="display: flex; flex-direction: column; gap: 10px;">
            <button class="btn-primary" onclick="saveTask()">üíæ –ó–∞–ø–∞–∑–∏ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ</button>
            <button onclick="deleteTask()" 
                    style="background: none; color: var(--danger); border: 1px solid var(--danger); padding: 0.75rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s;"
                    onmouseover="this.style.background='var(--danger)'; this.style.color='white'"
                    onmouseout="this.style.background='none'; this.style.color='var(--danger)'">
                üóëÔ∏è –ò–∑—Ç—Ä–∏–π –∑–∞–¥–∞—á–∞—Ç–∞
            </button>
            <a href="/" style="text-align: center; text-decoration: none; color: #64748b; font-size: 0.9rem; margin-top: 10px;">–û—Ç–∫–∞–∑ –∏ –≤—Ä—ä—â–∞–Ω–µ</a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    //–í–∑–∏–º–∞–º–µ ID-—Ç–æ, –∫–æ–µ—Ç–æ Python –∏–Ω–∂–µ–∫—Ç–∏—Ä–∞ –≤ HTML-–∞
    const taskId = "{{ task_id }}";

    // window.onload —Å–µ –∏–∑–ø—ä–ª–Ω—è–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –∏ –∫–æ–¥—ä—Ç —Ç—Ä—ä–≥–≤–∞ —Å–∞–º
    window.onload = async function() {
        const response = await fetch(`/tasks/${taskId}`); // –í–∑–µ–º–∞–º–µ –¥–∞–Ω–Ω–∏—Ç–µ –∑–∞ –∑–∞–¥–∞—á–∞—Ç–∞ —Å—ä—Å —Å—ä–æ—Ç–≤–µ—Ç–Ω–æ—Ç–æ ID –æ—Ç —Å—ä—Ä–≤—ä—Ä–∞
        if (response.ok) { // –ê–∫–æ –≤—Å–∏—á–∫–æ –µ –º–∏–Ω–∞–ª–æ –¥–æ–±—Ä–µ
            const task = await response.json(); // –í–∑–µ–º–∞–º–µ –¥–∞–Ω–Ω–∏—Ç–µ –Ω–∞ –∑–∞–¥–∞—á–∞—Ç–∞ –∫–∞—Ç–æ JSON
            // –ü–æ–ø—ä–ª–≤–∞–º–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–ª–µ—Ç–∞—Ç–∞ - —Ç–æ–≤–∞ –µ "–º–∞–≥–∏—è—Ç–∞", –≤–∑–∏–º–∞–º –¥–∞–Ω–Ω–∏—Ç–µ –∏ –≥–∏ —Å–ª–∞–≥–∞–º –≤ –µ–ª–µ–º–µ–Ω—Ç–∏—Ç–µ —Å—ä—Å —Å—ä–æ—Ç–≤–µ—Ç–Ω–∏—Ç–µ ID-—Ç–∞(–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏ –≤ HTML-–∞)
            document.getElementById('edit-title').value = task.title;
            document.getElementById('edit-desc').value = task.description || "";
        }
    };

    async function saveTask() { // –§—É–Ω–∫—Ü–∏—è, –∫–æ—è—Ç–æ —Å–µ –≤–∏–∫–∞ –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–µ –Ω–∞ –±—É—Ç–æ–Ω–∞ "–ó–∞–ø–∞–∑–∏ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ"
        const title = document.getElementById('edit-title').value; // –í–∑–µ–º–∞–º–µ –Ω–æ–≤–∏—Ç–µ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏ –æ—Ç –∏–Ω–ø—É—Ç–∏—Ç–µ
        const desc = document.getElementById('edit-desc').value; // –í–∑–µ–º–∞–º–µ –Ω–æ–≤–∏—Ç–µ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏ –æ—Ç –∏–Ω–ø—É—Ç–∏—Ç–µ

        // –ò–∑–ø–æ–ª–∑–≤–∞–º–µ PUT, –∑–∞—â–æ—Ç–æ –æ–±–Ω–æ–≤—è–≤–∞–º–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â —Ä–µ—Å—É—Ä—Å
        const response = await fetch(`/tasks/${taskId}`, {  // –ü—Ä–∞—â–∞–º–µ UPDATE –∑–∞—è–≤–∫–∞ –∫—ä–º –Ω–∞—à–∏—è /tasks/{task_id} endpoint
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' }, // –ö–∞–∑–≤–∞–º–µ, —á–µ –ø—Ä–∞—â–∞–º–µ JSON
            body: JSON.stringify({  // –¢—è–ª–æ—Ç–æ –Ω–∞ –∑–∞—è–≤–∫–∞—Ç–∞ –µ JSON –æ–±–µ–∫—Ç —Å –Ω–æ–≤–∏—Ç–µ –¥–∞–Ω–Ω–∏ –∑–∞ –∑–∞–¥–∞—á–∞—Ç–∞
                title: title,  // –ù–æ–≤–æ—Ç–æ –∑–∞–≥–ª–∞–≤–∏–µ
                description: desc // –ù–æ–≤–æ—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ
            })
        });

        if (response.ok) {
            alert("–£—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ!");
            window.location.href = "/"; // –ü—Ä–µ–Ω–∞—Å–æ—á–≤–∞–Ω–µ (–∫–∞—Ç–æ redirect –≤ Django)
        }
    }

    async function deleteTask() {
        // 1. –ü–æ—Ç–≤—ä—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è (–¥–æ–±—Ä–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞)
        if (!confirm("–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–∞–∑–∏ –∑–∞–¥–∞—á–∞?")) return;

        // 2. –ò–∑–ø—Ä–∞—â–∞–º–µ DELETE –∑–∞—è–≤–∫–∞ –∫—ä–º API-—Ç–æ
        const response = await fetch(`/tasks/${taskId}`, {
            method: 'DELETE'
        });

        if (response.ok) {
            alert("–ó–∞–¥–∞—á–∞—Ç–∞ –µ –∏–∑—Ç—Ä–∏—Ç–∞ —É—Å–ø–µ—à–Ω–æ!");
            window.location.href = "/"; // –í—Ä—ä—â–∞–º–µ —Å–µ –≤ –Ω–∞—á–∞–ª–Ω–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        } else {
            alert("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ—Ç–æ.");
        }
    }
</script>
{% endblock %}