{% extends "base.html" %}

{% block title %}–ù–∞—á–∞–ª–æ - –ú–æ–∏—Ç–µ –ó–∞–¥–∞—á–∏{% endblock %}

{% block content %}
<div class="user-nav" style="display: flex; justify-content: space-between; align-items: center; background: #f8fafc; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid var(--border);">
    <div>
        <span>üëã –ó–¥—Ä–∞–≤–µ–π, <strong>{{ user.username }}</strong>!</span>
        <span class="badge" style="background: var(--primary); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; margin-left: 10px;">
            {{ user.role | upper }}
        </span>
    </div>
    <div style="display: flex; gap: 15px;">
        {% if user.role == "admin" %}
            <a href="/admin/dashboard" class="btn-admin" style="text-decoration: none; color: #dc2626; font-weight: bold; border: 1px solid #dc2626; padding: 5px 10px; border-radius: 5px;">üõ†Ô∏è –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª</a>
        {% endif %}
        <a href="/logout" style="text-decoration: none; color: var(--text); font-weight: bold;">üö™ –ò–∑—Ö–æ–¥</a>
    </div>
</div>

<div class="task-card">
    <h2 style="color: var(--primary); margin-top: 0;">üöÄ –ù–æ–≤–∞ –∑–∞–¥–∞—á–∞</h2>
    <div class="form-grid">
        <div class="field-group">
            <label>–ó–∞–≥–ª–∞–≤–∏–µ</label>
            <input type="text" id="title" placeholder="–ö–∞–∫–≤–æ –ø–ª–∞–Ω–∏—Ä–∞—à?">
        </div>
        <div class="field-group">
            <label>–ö—Ä–∞–µ–Ω —Å—Ä–æ–∫</label>
            <input type="date" id="deadline">
        </div>
        <button class="btn-primary" onclick="createTask()">–î–æ–±–∞–≤–∏</button>
    </div>
</div>

<div class="tasks-section" style="margin-top: 30px;">
    <h3 style="border-bottom: 2px solid var(--border); padding-bottom: 10px;">üìã –°–ø–∏—Å—ä–∫ —Å—ä—Å –∑–∞–¥–∞—á–∏</h3>
    <ul class="task-list">
        {% for task in tasks %}
            <li class="task-item">
                <div class="task-info">
                    <strong style="display: block;">{{ task.title }}</strong>
                    <small style="color: #64748b;">üìÖ –ö—Ä–∞–µ–Ω —Å—Ä–æ–∫: {{ task.deadline or '–ù—è–º–∞' }}</small>
                </div>
                <a href="/edit/{{ task.id }}" class="edit-link">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</a>
            </li>
        {% endfor %}
    </ul>
</div>

{% block scripts %}
<script>
async function createTask() {
    const title = document.getElementById('title').value;
    const deadline = document.getElementById('deadline').value;

    if (!title) {
        alert("–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –∑–∞–≥–ª–∞–≤–∏–µ!");
        return;
    }

    const taskData = {
        title: title,
        description: "", // –ü—Ä–∞—â–∞–º–µ –ø—Ä–∞–∑–µ–Ω –Ω–∏–∑, —Ç—ä–π –∫–∞—Ç–æ –≤ —Å—Ö–µ–º–∞—Ç–∞ –µ Optional
        task_type: "WorkTask", // –ó–∞–¥–∞–≤–∞–º–µ –≥–æ —Ç–≤—ä—Ä–¥–æ –∑–∞ –º–æ–º–µ–Ω—Ç–∞, –∑–∞ –¥–∞ –º–∏–Ω–µ —Å—Ö–µ–º–∞—Ç–∞
        deadline: deadline || null,
        priority: null
    };

    try {
        const response = await fetch('/tasks', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(taskData)
        });

        if (response.ok) {
            window.location.reload(); // –ü—Ä–µ–∑–∞—Ä–µ–∂–¥–∞–º–µ, –∑–∞ –¥–∞ –≤–∏–¥–∏–º –Ω–æ–≤–∞—Ç–∞ –∑–∞–¥–∞—á–∞
        } else {
            const error = await response.json();
            alert("–ì—Ä–µ—à–∫–∞: " + JSON.stringify(error.detail));
        }
    } catch (err) {
        console.error("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑–ø—Ä–∞—â–∞–Ω–µ:", err);
    }
}
</script>
{% endblock %}
{% endblock %}